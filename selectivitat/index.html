<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Problemes de Tecnologia i Enginyeria</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script src="questions.js" defer></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h2>
    Problemes de Tecnologia i Enginyeria 
    <span id="dark-toggle" style="cursor:pointer; margin-left:10px;">üåô</span>
</h2>

<label for="type-select">Tipus de preguntes:</label>
<select id="type-select" onchange="renderQuiz()">
    <option value="totes">Totes</option>
    <option value="questions">Q√ºestions</option>
    <option value="exercicis">Exercicis</option>
</select>

<label for="category-select">Tria una categoria:</label>
<select id="category-select" onchange="renderQuiz()">
<option value="tot">Tot</option>
<option value="energia">Energia</option>
<option value="materials">Materials i assaigs</option>
<option value="metrologia">Metrologia i normalitzaci√≥</option>
<option value="pneumatica">Sistemes pneum√†tics i oleohidr√†ulics</option>
<option value="motors">Motors reductors</option>
<option value="maquines">Principis de les m√†quines</option>
<option value="electrics">M√†quines i sistemes el√®ctrics i electrot√®cnics</option>
<option value="control">Control l√≤gic i funcions l√≤giques</option>
<option value="organitzacio">Organitzaci√≥ industrial</option>

</select>

<div id="quiz-container"></div>

<style>
body.dark-mode { background-color: #121212; color: #f0f0f0; }
body { font-family: Arial, sans-serif; transition: background-color 0.3s, color 0.3s; }
.ocult { display: none; }
.visible { display: block; }
.correcta { color: green; }
.incorrecta { color: red; }
.solution-button { margin-top: 10px; }
.question-images { margin: 10px 0; }
ul { padding-left: 20px; }
</style>
<div id="load-time" style="margin-top:20px; font-style:italic; color: #555;"></div>

<div id="load-time" style="margin-top:20px; font-style:italic; color: #555;"></div>

<script>
let domReadyTime = 0;  // guardarem temps DOM

document.addEventListener("DOMContentLoaded", () => {
    domReadyTime = (performance.now()).toFixed(2);
    console.log(`DOM carregat en: ${domReadyTime} ms`);
});

window.addEventListener('load', async () => {
    const loadCompleteTime = (performance.now()).toFixed(2);
    console.log(`P√†gina completament carregada en: ${loadCompleteTime} ms`);

    await MathJax.typesetPromise();
    const mathjaxDoneTime = (performance.now()).toFixed(2);
    console.log(`MathJax complet en: ${mathjaxDoneTime} ms`);

    const loadDiv = document.getElementById("load-time");
    loadDiv.innerHTML = `
        <strong>Temps de c√†rrega:</strong><br>
        DOM llest: ${domReadyTime} ms<br>
        P√†gina completa: ${loadCompleteTime} ms<br>
        MathJax renderitzat: ${mathjaxDoneTime} ms
    `;
});
</script>


<script>
/* ----------------- Mode fosc ----------------- */
const toggle = document.getElementById("dark-toggle");
toggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    toggle.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
});
document.addEventListener("DOMContentLoaded", () => {
    if(localStorage.getItem("theme")==="dark") { document.body.classList.add("dark-mode"); toggle.textContent="‚òÄÔ∏è"; }
});

/* ----------------- Funci√≥ auxiliar per imatges ----------------- */
function renderImages(q) {
    let html = '';
    if(q.images) html += `<div class="question-images">${q.images}</div>`;
    if(q.answerImage) html += `<img src="${q.answerImage}" alt="Imatge de la resposta" style="max-width:100%; height:auto;">`;
    return html;
}

/* ----------------- Funci√≥ per opcions ----------------- */
function generateOptions(options, idx, correctAnswer) {
    if(!options) return '';
    return `<ul>${options.map(o => `
        <li>
            <span class="option-letter">${o.value.toUpperCase()}</span>
            <button onclick="checkAnswer('${o.value}','${correctAnswer}','answer${idx}','steps${idx}','result${idx}')">
                ${o.text}
            </button>
        </li>`).join('')}</ul>`;
}

/* ----------------- Render Quiz combinat ----------------- */
function renderQuiz() {
    const quizContainer = document.getElementById("quiz-container");
    const selectedCategory = document.getElementById("category-select").value;
    const selectedType = document.getElementById("type-select").value;

    quizContainer.innerHTML = '';

    const filtered = questions.map((q,i)=>({...q, originalIndex:i}))
        .filter(q => (selectedCategory==='tot' || q.category===selectedCategory)
                  && (selectedType==='totes' || q.type===selectedType));

    filtered.forEach(q => {
        const div = document.createElement("div");
        div.innerHTML = `
            <p><strong>${q.type==='exercicis'?'Exercici':'Q√ºesti√≥'} ${q.originalIndex+1}:</strong> ${q.text}</p>
            ${renderImages(q)}
            ${generateOptions(q.options,q.originalIndex,q.correctAnswer)}
            <div id="result${q.originalIndex}" class="ocult">
                <p id="answer${q.originalIndex}"></p>
                <p><strong>Soluci√≥ pas a pas:</strong></p>
                <p id="steps${q.originalIndex}">${q.steps || ''}</p>
            </div>
            ${q.type==='exercicis'?`<button class="solution-button" onclick="toggleSolution(${q.originalIndex},this)">Mostra soluci√≥</button>`:''}
        `;
        quizContainer.appendChild(div);
    });

    MathJax.typesetPromise();
}

/* ----------------- Comprovaci√≥ resposta ----------------- */
function checkAnswer(selected, correct, answerId, stepsId, resultId) {
    const a = document.getElementById(answerId), s = document.getElementById(stepsId), r = document.getElementById(resultId);
    a.innerHTML = selected.trim().toLowerCase()===correct.trim().toLowerCase() 
        ? "<span class='correcta'>Correcte! Has seleccionat la resposta correcta.</span>"
        : `<span class='incorrecta'>Incorrecte. La resposta correcta √©s ${correct.toUpperCase()}.</span>`;
    r.classList.add('visible');
    const btn = r.previousElementSibling;
    if(btn && btn.classList.contains('solution-button')) btn.style.display='block';
    MathJax.typesetPromise();
}

/* ----------------- Toggle soluci√≥ ----------------- */
async function toggleSolution(idx, btn) {
    const r = document.getElementById(`result${idx}`);
    if(r.classList.contains('visible')) { r.classList.replace('visible','ocult'); btn.textContent='Mostra soluci√≥'; }
    else { r.classList.replace('ocult','visible'); btn.textContent='Amaga soluci√≥'; }
    await MathJax.typesetPromise();
}

/* ----------------- Inicialitzaci√≥ ----------------- */
document.addEventListener("DOMContentLoaded", renderQuiz);
</script>
</body>
</html>
